{"version":3,"sources":["js/util/cc-util.js"],"names":["e","t","n","r","s","o","u","a","require","i","Error","f","exports","call","length","1","module","define","EBANX","alert","url","waitFor","formatDueDate","expiry","dueDateSplited","replace","split","title","attr","enableBtnPlaceOrder","$","removeAttr","card_number","card_name","card_due_date","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","createTokenCallback","Symbol","iterator","next","done","value","localAmount","parseFloat","Math","round","term","localAmountWithTax","toFixed","options","instalmentNumber","hasInterests","err","return","instalmentSelector","innerHTML","showAlertMessage","errorMessage","dueDate","content","disableBtnPlaceOrder","tokenize","_ref","country","number","cvv","form","validation","validateForm","Promise","resolve","reject","config","setMode","window","checkoutConfig","payment","ebanx","mode","setPublishableKey","publicKey","setCountry","card","ebanxResponse","data","status","status_message","createInstalment","onUpdateTotalsAndInstalments","grand_total","post","build","responsePaymentTerms"],"mappings":"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","file":"cc-util.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\ndefine(\n  [\n    'lib-js',\n    'jquery',\n    'Magento_Ui/js/modal/alert',\n    'mage/url',\n    'wait-for',\n  ],\n  function(EBANX, $, alert, url, waitFor) {\n    'use strict';\n\n    const formatDueDate = expiry => {\n      const dueDateSplited = expiry.replace(/ /g, '').split('/');\n      const dueDate = dueDateSplited[0] + '/20' + dueDateSplited[1];\n      return dueDate;\n    };\n\n    const showAlertMessage = (errorMessage, title) => {\n      alert({\n        title: title,\n        content: errorMessage,\n      });\n    };\n\n    const disableBtnPlaceOrder = () => {\n      $('#btn_cc_br_form_place_order').attr('disabled', 'disabled');\n    };\n\n    const enableBtnPlaceOrder = () => {\n      $('#btn_cc_br_form_place_order').removeAttr('disabled');\n    };\n\n    const validateForm = (form) => {\n      return $(form).validation() && $(form).validation('isValid');\n    };\n\n    const tokenize = ({\n      number,\n      expiry,\n      cvv,\n    }, country) => {\n      disableBtnPlaceOrder();\n\n      if (!validateForm('#card-form')) {\n        enableBtnPlaceOrder();\n        return new Promise((resolve) => resolve(false));\n      }\n\n      const card_number = number.replace(/ /g, '');\n      const card_due_date = formatDueDate(expiry);\n      const card_cvv = cvv.replace(/ /g, '');\n\n      return new Promise((resolve, reject) => {\n        EBANX.config.setMode(window.checkoutConfig.payment.ebanx.mode);\n        EBANX.config.setPublishableKey(window.checkoutConfig.payment.ebanx.publicKey);\n        EBANX.config.setCountry(country);\n\n        const createTokenCallback = ebanxResponse => {\n          enableBtnPlaceOrder();\n          if (ebanxResponse.data && ebanxResponse.data.status === 'SUCCESS') {\n            resolve(ebanxResponse.data);\n          } else {\n            const errorMessage = ebanxResponse.error.err.message || ebanxResponse.error.err.status_message;\n            reject(errorMessage);\n          }\n        };\n\n        EBANX.card.createToken({\n          card_number: card_number,\n          card_name: 'Magento Credit Card',\n          card_due_date: card_due_date,\n          card_cvv: card_cvv,\n        }, createTokenCallback);\n      });\n    };\n\n    const createInstalment = paymentTerms => {\n      let options = '';\n      let localAmount;\n\n      for (let term of paymentTerms) {\n        localAmount = parseFloat(Math.round(term.localAmountWithTax * 100) / 100).toFixed(2);\n        options += `<option value='${term.instalmentNumber}' data-local-amount='${localAmount}'>${term.instalmentNumber}x de R$${localAmount} ${term.hasInterests ? 'com juros' : ''} </option>`;\n      };\n\n      waitFor(() => {\n        return document.querySelector('#instalment-cc-br');\n      }, (instalmentSelector) => {\n        instalmentSelector.innerHTML = `${options}`;\n      });\n    };\n\n    const onUpdateTotalsAndInstalments = (grand_total, country) => {\n      $.post(\n        url.build('ebanx/payment/instalmentterms'), {\n          country: country,\n          amount: grand_total,\n        },\n        'json'\n      ).done((responsePaymentTerms) => {\n        createInstalment(responsePaymentTerms);\n      });\n    };\n\n    return {\n      formatDueDate: formatDueDate,\n      showAlertMessage: showAlertMessage,\n      disableBtnPlaceOrder: disableBtnPlaceOrder,\n      enableBtnPlaceOrder: enableBtnPlaceOrder,\n      tokenize: tokenize,\n      createInstalment: createInstalment,\n      onUpdateTotalsAndInstalments: onUpdateTotalsAndInstalments,\n    };\n  });\n\n},{}]},{},[1])"]}