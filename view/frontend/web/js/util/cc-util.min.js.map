{"version":3,"sources":["js/util/cc-util.js"],"names":["e","t","n","r","s","o","u","a","require","i","Error","f","exports","call","length","1","module","define","EBANX","url","waitFor","expiry","dueDateSplited","replace","split","alert","title","attr","enableBtnPlaceOrder","$","removeAttr","card","card_number","card_name","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","card_cvv","localAmount","createTokenCallback","round","term","localAmountWithTax","toFixed","options","instalmentNumber","hasInterest","err","_iterator","return","createInstalment","document","instalmentSelector","innerHTML","formatDueDate","showAlertMessage","content","errorMessage","disableBtnPlaceOrder","tokenize","_ref","country","number","cvv","form","validation","validateForm","Promise","resolve","reject","card_due_date","config","checkoutConfig","payment","ebanx","mode","setCountry","ebanxResponse","data","status","error","message","status_message","onUpdateTotalsAndInstalments","grand_total","post","build","done","responsePaymentTerms"],"mappings":"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","file":"cc-util.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\ndefine(\n  [\n    'lib-js', \n    'jquery', \n    'Magento_Ui/js/modal/alert',\n    'mage/url',\n    'wait-for',\n  ], \n  function(EBANX, $, alert, url, waitFor) {\n    'use strict';\n\n    const formatDueDate = expiry => {\n        const dueDateSplited = expiry.replace(/ /g, '').split('/');\n        const dueDate = dueDateSplited[0] + '/20' + dueDateSplited[1];\n        return dueDate;\n    }\n\n    const showAlertMessage = (errorMessage, title) => {\n        alert({\n            title: title,\n            content: errorMessage,\n        });\n    }\n\n    const disableBtnPlaceOrder = () => {\n        $('#btn_cc_br_form_place_order').attr('disabled', 'disabled');\n    }\n\n    const enableBtnPlaceOrder = () => {\n        $('#btn_cc_br_form_place_order').removeAttr('disabled');\n    }\n\n    const validateForm = (form) => {\n        return $(form).validation('isValid');\n    }\n\n    const tokenize = ({ number, expiry, cvv }, country) => {\n        disableBtnPlaceOrder();\n\n        if (!validateForm('#card-form')) {\n          enableBtnPlaceOrder();\n          return new Promise((resolve, reject) => resolve(false));\n        }\n\n        const card_number = number.replace(/ /g, '');\n        const card_due_date = formatDueDate(expiry);\n        const card_cvv = cvv.replace(/ /g, '');\n\n        return new Promise((resolve, reject) => {\n            EBANX.config.setMode(window.checkoutConfig.payment.ebanx.mode);\n            EBANX.config.setPublishableKey(window.checkoutConfig.payment.ebanx.publicKey);\n            EBANX.config.setCountry(country);\n\n            const createTokenCallback = ebanxResponse => {\n                enableBtnPlaceOrder();\n                if (ebanxResponse.data && ebanxResponse.data.status === 'SUCCESS') {\n                    resolve(ebanxResponse.data);\n                } else {\n                    const errorMessage = ebanxResponse.error.err.message || ebanxResponse.error.err.status_message;\n                    reject(errorMessage);\n                }\n            };\n\n            EBANX.card.createToken(\n                {\n                card_number: card_number,\n                card_name: 'Magento Credit Card',\n                card_due_date: card_due_date,\n                card_cvv: card_cvv\n                },\n                createTokenCallback\n            );\n        });\n    }\n\n    const createInstalment = paymentTerms => {\n        let options = ``;\n        let localAmount;\n\n        for(let term of paymentTerms){\n            localAmount = parseFloat(Math.round(term.localAmountWithTax*100)/100).toFixed(2);\n            options += `<option value='${term.instalmentNumber}' data-local-amount='${localAmount}'>${term.instalmentNumber}x de R$${localAmount} ${term.hasInterest ? 'com juros' : ''} </option>`\n        }\n\n        waitFor(() => {\n            return document.querySelector('#instalment-cc-br');\n        }, (instalmentSelector) => {\n            instalmentSelector.innerHTML = `${options}`;\n        });\n\n    }\n\n    const onUpdateTotalsAndInstalments = (grand_total, country) => {\n        $.post(\n          url.build('ebanx/payment/instalmentterms'),\n          {\n            country: country,\n            amount: grand_total\n          },\n          'json'\n        ).done((responsePaymentTerms) => {\n          createInstalment(responsePaymentTerms);\n        });\n      }\n\n    return {\n        formatDueDate: formatDueDate,\n        showAlertMessage: showAlertMessage,\n        disableBtnPlaceOrder: disableBtnPlaceOrder,\n        enableBtnPlaceOrder: enableBtnPlaceOrder,\n        tokenize: tokenize,\n        createInstalment: createInstalment,\n        onUpdateTotalsAndInstalments: onUpdateTotalsAndInstalments\n    };\n});\n\n},{}]},{},[1])"]}